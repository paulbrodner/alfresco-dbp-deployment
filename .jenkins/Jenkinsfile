pipeline {
  agent {
    label "dbp"
  }

  options {        
    ansiColor('xterm')
  }

  environment {
    BRANCH_NAME      = "`echo ${env.GIT_BRANCH}|sed 's/\\\\//_/'`"
    DESIREDNAMESPACE = "${BRANCH_NAME}-${env.BUILD_NUMBER}"
    DNSZONE          = "${DESIREDNAMESPACE}.dev.alfresco.me"
  }

  stages {
    stage('Deploy') {
      steps {
        dir(".jenkins") {
          configFileProvider([configFile(fileId: 'secrets.yml', variable: 'SECRETS_YAML')]) {
            sh "make build"
          }          
        }
      }
    }   
  }
}
