pipeline {
  agent {
    label "dbp"
  }

  options {        
    ansiColor('xterm')
  }

  environment {
    AWS_ACCESS_KEY_ID       = credentials('dbp-user')
    AWS_SECRET_ACCESS_KEY   = credentials('dbp-user')
    BRANCH_NAME             = "`echo ${env.GIT_BRANCH}|sed 's/\\\\//-/'`"
    DESIREDNAMESPACE        = "${env.BUILD_NUMBER}-${BRANCH_NAME}"
    DNSZONE                 = "${DESIREDNAMESPACE}.dev.alfresco.me"
  }

  stages {
    stage('Deploy') {
      steps {
        dir(".jenkins") {
          configFileProvider([configFile(fileId: 'secrets.yml', variable: 'SECRETS_YAML')]) {
            sh "make build"
          }          
        }
      }
    }   
  }
}
